<h1>タスク一覧</h1>
<p>ログイン中のユーザー: {{ request.user.username }}</p>
<p><a href="{% url 'accounts:create' %}">新規作成</a></p>
<button type="button" onclick="history.back()">前画面に戻る</button>

<table>
    <thead>
        <tr>
        <th scope="col">タイトル</th>
        <th scope="col">期限</th>
        <th scope="col">重要度</th>
        <th scope="col">優先度</th>
        </tr>
    </thead>
    <a href="?sort=urgency">緊急度でソート</a> |
    <a href="?sort=importance">重要度でソート</a>

    <h3>フィルタリング</h3>
    <form method="GET">
        <label for="urgency">緊急度:</label>
        <select name="urgency" id="urgency">
            <option value="">すべて</option>
            <option value="1">1 - 低</option>
            <option value="2">2</option>
            <option value="3">3 - 中</option>
            <option value="4">4</option>
            <option value="5">5 - 高</option>
        </select>

        <label for="importance">重要度:</label>
        <select name="importance" id="importance">
            <option value="">すべて</option>
            <option value="1">1 - 低</option>
            <option value="2">2</option>
            <option value="3">3 - 中</option>
            <option value="4">4</option>
            <option value="5">5 - 高</option>
        </select>

        <button type="submit">フィルタ適用</button>
    </form>

    <h3>絞り込み</h3>
    <form method="GET">
        <label for="title">タイトルで絞り込み:</label>
        <input type="text" name="title" id="title" value="{{ request.GET.title }}">
    </form>

    <tbody>
    {% for task in tasks %}
    <tr>
        <td>{{ task.title }}</td>
        <td>{{ task.deadline }}</td>
        <td>{{ task.urgency }}</td>
        <td>{{ task.importance }}</td>
        <td><a href="{% url 'accounts:detail' task.pk %}">詳細</a></td>
        <td><a href="{% url 'accounts:update' task.pk %}">編集</a></td>
        <td><a href="{% url 'accounts:delete' task.pk %}">削除</a></td>
        <td>
            {% if task.is_past_due %}
                <span style="color: orange;">期限が過ぎています！</span>
            {% elif task.is_approaching_deadline %}
                <span style="color: red;">締め切りまで3日以内です！</span>
            {% endif %}
        </td>
    </tr>
    {% empty %}
            <tr>
                <td colspan="4">タスクがありません</td>
            </tr>
    {% endfor %}
    </tbody>
</table>